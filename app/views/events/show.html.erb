<main class="container event-details">
  <header class="event-header">
    <h1>Event Details</h1>
  </header>

  <section class="event-info">
    <div class="event-bubble">
      <h3>Event Start Date</h3>
      <p><%= @event.start_time.strftime("%B %d, %Y") %></p>
    </div>

    <div class="event-bubble">
      <h3>Start Time</h3>
      <p><%= @event.start_time.strftime("%l:%M %p") %></p>
    </div>

    <% if @event.end_time.present? %>
      <div class="event-bubble">
        <h3>End Time</h3>
        <p><%= @event.end_time.strftime("%l:%M %p") %></p>
      </div>
    <% end %>

    <div class="event-bubble">
      <h3>Description</h3>
      <p><%= @event.description %></p>
    </div>

    <% if current_user.role == 'admin' %>
      <div class="event-bubble">
        <h3>Attendance Passcode</h3>
        <p><%= @event.passcode %></p>
      </div>
    <% end %>
  </section>

  <section class="action-buttons">
    <%= link_to 'Edit Event', edit_event_path(@event), class: 'btn btn--primary' %>
    <%= link_to 'Delete Event', event_path(@event), data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }, class: 'btn btn--danger' %>
    <%= link_to 'Back to Events', events_path, class: 'btn btn--secondary' %>

    <% if @event.archived? %>
      <%= link_to 'Unarchive Event', unarchive_event_path(@event), method: :put, data: { confirm: 'Are you sure?' }, class: 'btn btn--tertiary' %>
    <% else %>
      <%= link_to 'Archive', archive_event_path(@event), method: :put, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn--tertiary' %>
    <% end %>
  </section>

  <% if current_user.role == 'member' %>
    <section class="checkin-form">
      <%= form_with url: event_attendances_path(@event), local: true do |form| %>
        <div class="form-group">
          <%= form.label :passcode, "Enter Attendance Passcode" %>
          <%= form.text_field :passcode, name: 'passcode', class: 'form-control' %>
        </div>
        <div class="form-group">
          <%= form.submit "Check In", class: 'btn btn--secondary' %>
        </div>
      <% end %>
    </section>
  <% end %>

  <section class="attendance-list">
    <h2>Attendance List</h2>
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>User</th>
          <th>Present?</th>
          <th>Checked In At</th>
        </tr>
      </thead>
      <tbody>
        <% @attendances.each do |attendance| %>
          <tr>
            <td><%= attendance.user.full_name %></td>
            <td><%= attendance.present? ? 'Yes' : 'No' %></td>
            <td><%= attendance.checked_in_at ? attendance.checked_in_at.strftime("%B %d, %Y %l:%M %p") : 'N/A' %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>
</main>
