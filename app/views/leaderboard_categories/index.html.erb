<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard</title>
  <%= stylesheet_link_tag 'application', media: 'all' %>
</head>
<body>
  <main class="container">
    <header class="header">
      <h1 class="header">LEADERBOARD</h1>
    </header>
    <div class="page-layout">
      <!-- Leaderboard table -->
      <div class="page-layout__leaderboard">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Points</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <% category = LeaderboardCategory.category_for_user(user.points) %>
              <% color_class = category && category.color && category.color_is_dark? ? 'light-text' : 'dark-text' %>
              <tr class="page-layout__leaderboard--highlighted <%= color_class %>" style="background-color: <%= category&.color || 'none' %>">
                <td><%= user.full_name %></td>
                <td><%= user.points %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <!-- Categories section using Turbo Stream-compatible div layout -->
      <div class="page-layout__categories">
        <h1>Categories</h1>
        <div class="categories-table">
          <div class="categories-table__header">
            <div class="categories-table__cell">Category Name</div>
            <div class="categories-table__cell">Minimum Points</div>
            <div class="categories-table__cell">Color</div>
          </div>

          <div id="categories">
            <%= turbo_frame_tag LeaderboardCategory.new %>
            <% @leaderboard_categories.each do |category| %>
              <%= turbo_frame_tag dom_id(category) do %>
                <div class="categories-table__row">
                  <div class="categories-table__cell">
                    <%= link_to category.category_name, leaderboard_category_path(category) %>
                  </div>
                  <div class="categories-table__cell"><%= category.min_points %></div>
                  <div class="categories-table__cell color-example" style="background-color: <%= category.color %>"></div>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>

        <div style="text-align: right; margin-bottom: 20px;">
          <%= link_to 'New Category', new_leaderboard_category_path, class: 'btn btn-primary' %>
        </div>
      </div>
    </div>
  </main>

  <%= javascript_include_tag 'application' %>
</body>
</html>
